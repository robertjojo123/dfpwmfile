-- Get the wireless modem
local modem = peripheral.find("modem")

-- Check if the modem is connected
if not modem then
    print("No modem found.")
    return
end

-- Open the modem on a specific channel (channel 100)
modem.open(100)

-- Specify the file to send
local filePath = "/path/to/your/file.txt"

-- Read the entire file as a string
local file = io.open(filePath, "r")
if not file then
    print("Could not open file.")
    return
end

local fileContent = file:read("*all")  -- Read the entire file into memory
file:close()

-- Define the maximum modem message size
local maxMessageSize = 4096  -- 4 KB limit for modem messages

-- Send the file in chunks (size limited by modem)
local totalChunks = math.ceil(#fileContent / maxMessageSize)
print("Sending file... Total chunks: " .. totalChunks)

for i = 1, totalChunks do
    -- Calculate the start and end positions for the chunk
    local startIdx = (i - 1) * maxMessageSize + 1
    local endIdx = math.min(i * maxMessageSize, #fileContent)
    
    -- Get the chunk of file content
    local chunk = fileContent:sub(startIdx, endIdx)
    
    -- Send the chunk with the chunk ID
    modem.transmit(100, i, chunk)
    print("Sent chunk " .. i .. "/" .. totalChunks)
    
    -- Optional: Small delay to avoid flooding the network
    os.sleep(0.1)
end

-- Send a completion signal
modem.transmit(100, totalChunks + 1, "END")
print("File sent successfully. Completion signal sent.")
