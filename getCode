-- Get the wireless modem
local modem = peripheral.find("modem")

-- Check if the modem is connected
if not modem then
    print("No modem found.")
    return
end

-- Open the modem on the same channel as the sender (channel 100)
modem.open(100)

-- Specify the file to save the received content
local filePath = "/path/to/save/received_file.txt"
local file = io.open(filePath, "w")
if not file then
    print("Could not open file.")
    return
end

-- Prepare to receive the chunks
print("Waiting for file...")

local chunksReceived = 0
local totalChunks = nil
local fileContent = ""

-- Listen for incoming chunks
while true do
    local _, _, _, _, chunkId, chunk = os.pullEvent("modem_message")
    
    -- Handle the special "END" signal to indicate file completion
    if chunk == "END" then
        print("File transfer complete.")
        break
    end
    
    -- Store the chunk in the correct order
    if totalChunks == nil then
        totalChunks = chunkId - 1  -- The total number of chunks
    end
    
    fileContent = fileContent .. chunk
    chunksReceived = chunksReceived + 1
    print("Received chunk " .. chunkId .. "/" .. totalChunks)
    
    -- Write the file content to the disk once all chunks are received
    if chunksReceived == totalChunks then
        file:write(fileContent)
        break
    end
end

file:close()
print("File received and saved successfully.")
